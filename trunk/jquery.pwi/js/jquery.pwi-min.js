/**
 * Picasa Webalbum Integration jQuery plugin
 * This library was inspired aon pwa by Dieter Raber
 * @name jquery.pwi.js
 * @author Jeroen Diderik - http://www.jdee.nl/
 * @author Johan Borkhuis - http://www.borkhuis.com/
 * @revision 1.5.0
 * @date September 18, 2011
 * @copyright (c) 2010-2011 Jeroen Diderik(www.jdee.nl)
 * @license Creative Commons Attribution-Share Alike 3.0 Netherlands License - http://creativecommons.org/licenses/by-sa/3.0/nl/
 * @Visit http://pwi.googlecode.com/ for more informations, discussions etc about this library
 */
function formatTitle(a,b,c,d){var e='<table id="fancybox-title-float-wrap" cellpadding="0" cellspacing="0"><tr><td id="fancybox-title-float-left"></td><td id="fancybox-title-float-main">'+a+'</td><td id="fancybox-title-float-right"></td></tr></table>';if(d.orig.context.parentNode.childElementCount>1){var f=d.orig.context.parentNode.getElementsByClassName("downloadlink");if(f.length>0){var g='<a style="color: #FFF;" href="'+f[0].href+'">Download</a>';e='<table id="fancybox-title-float-wrap" cellpadding="0" cellspacing="0"><tr><td id="fancybox-title-float-left"></td><td id="fancybox-title-float-main">'+a+"  "+g+'</td><td id="fancybox-title-float-right"></td></tr></table>'}}return e}(function(a){var b,c={};a.fn.pwi=function(c){function u(b,c){if(b){if(e.loadingImage.length>0){var f=document.getElementById(e.loadingImage);if(f){f.style.display="block"}}document.body.style.cursor="wait";if(a.blockUI){d.block(e.blockUIConfig)}}else{if(e.loadingImage.length>0){var f=document.getElementById(e.loadingImage);if(f){f.style.display="none"}}document.body.style.cursor="default";if(a.blockUI){d.unblock()}d.html(c)}}function t(){u(true,"");var b="http://picasaweb.google.com/data/feed/api/user/"+e.username+(e.album!==""?"/album/"+e.album:"")+"?kind=photo&max-results="+e.maxResults+"&alt=json&q="+(e.authKey!==""?"&authkey="+e.authKey:"")+(e.keyword!==""?"&tag="+e.keyword:"")+"&imgmax=d&thumbsize="+e.thumbSize+(e.thumbCrop==1?"c":"u")+","+e.photoSize;a.getJSON(b,"callback=?",o);return d}function s(){if(e.photostore[e.album]){n(e.photostore[e.album])}else{var b="http://picasaweb.google.com/data/feed/api/user/"+e.username+(e.album!==""?"/album/"+e.album:"")+"?kind=photo&alt=json"+(e.authKey!==""?"&authkey="+e.authKey:"")+(e.keyword!==""?"&tag="+e.keyword:"")+"&imgmax=d&thumbsize="+e.thumbSize+(e.thumbCrop==1?"c":"u")+","+e.photoSize;u(true,"");a.getJSON(b,"callback=?",n)}return d}function r(){if(e.albumstore.feed){m(e.albumstore)}else{u(true,"");var b="http://picasaweb.google.com/data/feed/api/user/"+e.username+"?kind=album&access="+e.albumTypes+"&alt=json&thumbsize="+e.albumThumbSize+(e.albumCrop==1?"c":"u");a.getJSON(b,"callback=?",m)}return d}function q(a){a.stopPropagation();a.preventDefault();e.onclickThumb(a)}function p(a){a.stopPropagation();a.preventDefault();e.onclickAlbumThumb(a)}function o(b){var c=a("<div/>"),d=b.feed?b.feed.entry.length:0,f=0;var g=e.username.replace(/[@\.]/g,"_");k(b,e.sortPhotos);while(f<e.maxResults&&f<d){var h=l(b.feed.entry[f],false,g);c.append(h);f++}c.append("<div style='clear: both;height:0px;'> </div>");var i=a("div.pwi_photo",c).css(e.thumbCss);if(e.popupPlugin==="fancybox"){e.popupExt("lb",i.find("a[rel='lb-"+g+"']"));e.popupExt("yt",i.find("a[rel='yt-"+g+"']"));e.popupExt("sl",i.find("a[rel='sl-"+g+"']"));e.popupExt("map",i.find("a[rel='map-"+g+"']"))}else if(e.popupPlugin==="slimbox"){i.find("a[rel='lb-"+g+"']").slimbox(e.slimbox_config,function(a){var b=a.title;if(a.parentNode.childElementCount>1){var c=a.parentNode.getElementsByClassName("downloadlink");if(c.length>0){var d='<a href="'+c[0].href+'">Download</a>';b=a.title+"  "+d}}return[a.href,b]})}u(false,c)}function n(b){var c,d,f="",g=b.feed.openSearch$totalResults.$t,i="",j="",m=b.feed.gphoto$location===undefined?"":b.feed.gphoto$location.$t,n,o=h(b.feed.gphoto$timestamp===undefined?"":b.feed.gphoto$timestamp.$t),p=g=="1"?false:true;if(b.feed.subtitle===undefined){n=""}else{var q=b.feed.subtitle.$t.match(/\[keywords\s*:\s*.*\s*\](.*)/);if(q){n=q[1]}else{n=b.feed.subtitle.$t}}i=b.feed.title==="undefined"||e.albumTitle.length>0?e.albumTitle:b.feed.title.$t;c=a("<div/>");if(e.mode!="album"&&e.mode!="keyword"){f=a("<div class='pwi_album_backlink'>"+e.labels.albums+"</div>").bind("click.pwi",function(a){a.stopPropagation();r();return false});c.append(f)}if(e.showAlbumDescription){d=a("<div class='pwi_album_description'/>");d.append("<div class='title'>"+i+"</div>");d.append("<div class='details'>"+g+" "+(p?e.labels.photos:e.labels.photo)+(e.showAlbumdate?", "+o:"")+(e.showAlbumLocation&&m?", "+m:"")+"</div>");d.append("<div class='description'>"+n+"</div>");if(e.showSlideshowLink){if(e.mode==="keyword"||e.keyword!==""){}else{d.append("<div><a href='http://picasaweb.google.com/"+e.username+"/"+b.feed.gphoto$name.$t+""+(e.authKey!==""?"?authkey="+e.authKey:"")+"#slideshow/"+b.feed.entry[0].gphoto$id.$t+"' rel='gb_page_fs[]' target='_new' class='sslink'>"+e.labels.slideshow+"</a></div>")}}c.append(d)}if(e.showSlideshow&&e.popupPlugin==="fancybox"){var t=!a.support.opacity&&!window.XMLHttpRequest;var v=a("<div class='pwi_photo'/>");if(t||navigator.userAgent.match(/(iPad)|(iPhone)|(iPod)/i)!=null){for(var w=0;w<b.feed.link.length;w++){if(b.feed.link[w].type=="text/html"&&b.feed.link[w].rel=="alternate"){v.append("<a class='iframe' href='"+b.feed.link[w].href+"#slideshow/' rel='sl-"+e.username+"' title='"+o+"'>"+e.labels.slideshow+"</a><br>");break}}}else{for(var w=0;w<b.feed.link.length;w++){if(b.feed.link[w].type=="application/x-shockwave-flash"){v.append("<a class='iframe' href='"+b.feed.link[w].href+"' rel='sl-"+e.username+"' title='"+o+"'>"+e.labels.slideshow+"</a><br>");break}}}c.append(v);c.append("<div style='clear: both;height:0px;'/>")}if(g>e.maxResults){$pageCount=g/e.maxResults;var x=a("<div class='pwi_prevpage'/>").text(e.labels.prev),y=a("<div class='pwi_nextpage'/>").text(e.labels.next);j=a("<div class='pwi_pager'/>");if(e.page>1){x.addClass("link").bind("click.pwi",function(a){a.stopPropagation();e.page=parseInt(e.page,10)-1;s();return false})}j.append(x);for(var z=1;z<$pageCount+1;z++){if(z==e.page){f="<div class='pwi_pager_current'>"+z+"</div> "}else{f=a("<div class='pwi_pager_page'>"+z+"</div>").bind("click.pwi",z,function(a){a.stopPropagation();e.page=a.data;s();return false})}j.append(f)}if(e.page<$pageCount){y.addClass("link").bind("click.pwi",function(a){a.stopPropagation();e.page=parseInt(e.page,10)+1;s();return false})}j.append(y);j.append("<div style='clear: both;height:0px;'/>")}if(j.length>0&&(e.showPager==="both"||e.showPager==="top")){c.append(j)}k(b,e.sortPhotos);var A=(e.page-1)*e.maxResults;var B=e.maxResults*e.page;var C=e.username.replace(/[@\.]/g,"_");for(var w=0;w<g;w++){var D=l(b.feed.entry[w],!(w>=A&&w<B),C);c.append(D)}if(j.length>0&&(e.showPager==="both"||e.showPager==="bottom")){c.append(j.clone(true))}if(e.showPermaLink){c.append("<div style='clear: both;height:0px;'/>");var E=a("<div id='permalinkenable' class='pwi_nextpage'/>").text(e.labels.showPermaLink).bind("click.pwi",z,function(a){a.stopPropagation();var b=document.getElementById("permalinkbox");if(b){b.style.display="block"}b=document.getElementById("permalinkenable");if(b){b.style.display="none"}return false});var F=document.URL.split("?",2);var G=F[0]+"?pwi_album_selected="+b.feed.gphoto$name.$t+"&pwi_albumpage="+e.page;c.append(E);var H=a("<div style='display:none;' id='permalinkbox' />");var I=a("<form />");var J=a("<input type='text' size='40' name='PermaLink' readonly />").val(G);I.append(J);H.append(I);c.append(H)}e.photostore[e.album]=b;var K=a(".pwi_photo",c).css(e.thumbCss);if(e.popupPlugin==="fancybox"){e.popupExt("lb",K.find("a[rel='lb-"+C+"']"));e.popupExt("yt",K.find("a[rel='yt-"+C+"']"));e.popupExt("sl",K.find("a[rel='sl-"+C+"']"));e.popupExt("map",K.find("a[rel='map-"+C+"']"))}else if(e.popupPlugin==="slimbox"){K.find("a[rel='lb-"+C+"']").slimbox(e.slimbox_config,function(a){var b=a.title;if(a.parentNode.childElementCount>1){var c=a.parentNode.getElementsByClassName("downloadlink");if(c.length>0){var d='<a href="'+c[0].href+'">Download</a>';b=a.title+"  "+d}}return[a.href,b]})}c.append("<div style='clear: both;height:0px;'/>");u(false,c)}function m(b){var c=a("<div/>"),d=0;var f=0,g="",i=0;var j,l;if(navigator.userAgent.match(/(iPad)|(iPhone)|(iPod)/i)==null){j=new Date(e.albumStartDateTime);if(isNaN(j)){var n=e.albumStartDateTime.replace(/-/g,"/");j=new Date(n)}l=new Date(e.albumEndDateTime);if(isNaN(l)){var n=e.albumEndDateTime.replace(/-/g,"/");l=new Date(n)}}else{var n=e.albumStartDateTime.replace(/-/g,"/");j=new Date(n);n=e.albumEndDateTime.replace(/-/g,"/");l=new Date(n)}d=e.albumsPerPage*(e.albumPage-1);f=b.feed.entry.length;if(f>e.albumMaxResults){f=e.albumMaxResults}k(b,e.sortAlbums);while(d<e.albumMaxResults&&d<f&&d<e.albumsPerPage*e.albumPage){var o=new Date(Number(b.feed.entry[d].gphoto$timestamp.$t)),p=b.feed.entry[d].media$group.media$thumbnail[0].url;if((a.inArray(b.feed.entry[d].gphoto$name.$t,e.albums)>-1||e.albums.length===0)&&a.inArray(b.feed.entry[d].gphoto$name.$t,e.removeAlbums)==-1&&(b.feed.entry[d].gphoto$albumType===undefined||a.inArray(b.feed.entry[d].gphoto$albumType.$t,e.removeAlbumTypes)==-1)&&(e.albumStartDateTime==""||o>=j)&&(e.albumEndDateTime==""||o<=l)){var q=true;if(e.albumKeywords.length>0){q=false;var r=b.feed.entry[d].summary.$t.match(/\[keywords\s*:\s*(.*)\s*\]/);if(r){var t=new Array;var v=r[1].split(/,/);for(var w in v){$newmatch=v[w].match(/\s*['"](.*)['"]\s*/);if($newmatch){t.push($newmatch[1])}}if(t.length>0){q=true;for(var w in e.albumKeywords){if(a.inArray(e.albumKeywords[w],t)<0){q=false;break}}}}}if(q==true){i++;if(e.showAlbumThumbs){$scAlbum=a("<div class='pwi_album' style='height:180px;"+(e.albumThumbAlign==1?"width:"+(e.albumThumbSize+1)+"px;":"")+"cursor: pointer;'/>")}else{$scAlbum=a("<div class='pwi_album' style='cursor: pointer;'/>")}var x=b.feed.entry[d];$scAlbum.bind("click.pwi",x,function(a){a.stopPropagation();e.page=1;e.album=a.data.gphoto$name.$t;if(typeof e.onclickAlbumThumb==="function"){e.onclickAlbumThumb(a);return false}else{s();return false}});if(e.showAlbumThumbs){$scAlbum.append("<img src='"+p+"'/>")}if(e.showAlbumTitles){$item_plural=b.feed.entry[d].gphoto$numphotos.$t=="1"?false:true;$scAlbum.append("<br/>"+(b.feed.entry[d].title.$t.length>e.showAlbumTitlesLength?b.feed.entry[d].title.$t.substring(0,e.showCaptionLength):b.feed.entry[d].title.$t)+"<br/>"+(e.showAlbumdate?h(b.feed.entry[d].gphoto$timestamp.$t):"")+(e.showAlbumPhotoCount?"    "+b.feed.entry[d].gphoto$numphotos.$t+" "+($item_plural?e.labels.photos:e.labels.photo):""))}c.append($scAlbum)}}d++}c.append("<div style='clear: both;height:0px;'/>");if(i==0){c=a("<div class='pwi_album_description'/>");c.append("<div class='title'>"+e.labels.noalbums+"</div>");u(false,c);return}if(f>e.albumsPerPage){var y=f/e.albumsPerPage;var z=a("<div class='pwi_prevpage'/>").text(e.labels.prev),A=a("<div class='pwi_nextpage'/>").text(e.labels.next);$navRow=a("<div class='pwi_pager'/>");if(e.albumPage>1){z.addClass("link").bind("click.pwi",function(a){a.stopPropagation();e.albumPage=parseInt(e.albumPage,10)-1;m(b);return false})}$navRow.append(z);for(var w=1;w<y+1;w++){if(w==e.albumPage){tmp="<div class='pwi_pager_current'>"+w+"</div> "}else{tmp=a("<div class='pwi_pager_page'>"+w+"</div>").bind("click.pwi",w,function(a){a.stopPropagation();e.albumPage=a.data;m(b);return false})}$navRow.append(tmp)}if(e.albumPage<y){A.addClass("link").bind("click.pwi",function(a){a.stopPropagation();e.albumPage=parseInt(e.albumPage,10)+1;m(b);return false})}$navRow.append(A);$navRow.append("<div style='clear: both;height:0px;'/>");if($navRow.length>0&&(e.showPager==="both"||e.showPager==="top")){c.prepend($navRow.clone(true))}if($navRow.length>0&&(e.showPager==="both"||e.showPager==="bottom")){c.append($navRow)}}e.albumstore=b;u(false,c)}function l(b,c,d){var f,g="",h="",k="";if(b.summary){var l=b.summary.$t.match(/\[youtube\s*:\s*(.*)\s*\](.*)/);if(l){k=l[1];h=i(l[2])}else{h=i(b.summary.$t)}}if(e.showPhotoDate){if(b.exif$tags.exif$time){g=j(b.exif$tags.exif$time.$t)}else if(b.gphoto$timestamp){g=j(b.gphoto$timestamp.$t)}else{g=j(b.published.$t)}g+=" "}if(c){f=a("<div class='pwi_photo' style='display: none'/>");if(k==""){f.append("<a href='"+b.media$group.media$thumbnail[1].url+"' rel='lb-"+d+"' title='"+g+"'></a>")}else{f.append("<a class='iframe' href='http://www.youtube.com/embed/"+k+"?autoplay=1&rel=0&hd=1' rel='yt-"+d+"' title='"+g+"'></a>")}if(e.showPhotoDownloadPopup){var m=a("<div style='display: none'/>");m.append("<a class='downloadlink' href='"+b.media$group.media$content[0].url+"'/>");f.append(m)}return f}else{g+=h.replace(new RegExp("'","g"),"&#39;");f=a("<div class='pwi_photo' style='height:"+(e.thumbSize+(e.showPhotoCaption||e.showPhotoLocation?15:1))+"px;"+(e.thumbAlign==1?"width:"+(e.thumbSize+1)+"px;":"")+"cursor: pointer;'/>");if(k==""){f.append("<a href='"+b.media$group.media$thumbnail[1].url+"' rel='lb-"+d+"' title='"+g+"'><img src='"+b.media$group.media$thumbnail[0].url+"'/></a>")}else{f.append("<a class='iframe' href='http://www.youtube.com/embed/"+k+"?autoplay=1&rel=0&hd=1&autohide=1' rel='yt-"+d+"' title='"+g+"'><img id='main' src='"+b.media$group.media$thumbnail[0].url+"'/><img id='video' src='"+e.videoBorder+"' height='"+b.media$group.media$thumbnail[0].height+"' /></a>")}if(e.showPhotoDownloadPopup){var m=a("<div style='display: none'/>");m.append("<a class='downloadlink' href='"+b.media$group.media$content[0].url+"'/>");f.append(m)}if(e.showPhotoLocation||e.showPhotoCaption){f.append("<br/>");if(e.showPhotoLocation&&e.mapIconLocation!=""){if(b.georss$where&&b.georss$where.gml$Point&&b.georss$where.gml$Point.gml$pos){var n=a("<a class='iframe' href='http://maps.google.com/?output=embed&t=h&z=15&q="+b.georss$where.gml$Point.gml$pos.$t+"' rel='map-"+e.username+"'><img src='"+e.mapIconLocation+"'></a>");f.append(n)}}if(e.showPhotoCaption){if(e.showPhotoCaptionDate&&e.showPhotoDate){h=g}if(e.showPhotoDownload){h+='<a href="'+b.media$group.media$content[0].url+'">'+e.labels.downloadphotos+"</a>"}if(h.length>e.showCaptionLength){h=h.substring(0,e.showCaptionLength)}f.append(h)}}if(typeof e.onclickThumb==="function"){var o=b;f.bind("click.pwi",o,q)}return f}}function k(a,b){if(b!=="none"){function c(a,b){return Number(a.gphoto$timestamp.$t)>Number(b.gphoto$timestamp.$t)}function d(a,b){return Number(a.gphoto$timestamp.$t)<Number(b.gphoto$timestamp.$t)}function e(a,b){var c=a.title.$t.toLowerCase();var d=b.title.$t.toLowerCase();if(c<d){return-1}if(c>d){return 1}return 0}function f(a,b){var c=a.title.$t.toLowerCase();var d=b.title.$t.toLowerCase();if(c>d){return-1}if(c<d){return 1}return 0}if(b==="ASC_DATE"){a.feed.entry.sort(c)}else if(b==="DESC_DATE"){a.feed.entry.sort(d)}else if(b==="ASC_NAME"){a.feed.entry.sort(e)}else if(b==="DESC_NAME"){a.feed.entry.sort(f)}}}function j(a){var b=new Date(Number(a));$year=b.getUTCFullYear();if($year<1e3){$year+=1900}if(b=="Invalid Date"){return a}else{if(b.getUTCHours()==0&&b.getUTCMinutes()==0&&b.getUTCSeconds()==0){return b.getUTCDate()+"-"+(b.getUTCMonth()+1)+"-"+$year}else{return b.getUTCDate()+"-"+(b.getUTCMonth()+1)+"-"+$year+" "+b.getUTCHours()+":"+(b.getUTCMinutes()<10?"0"+b.getUTCMinutes():b.getUTCMinutes())}}}function i(a){return a.replace(/\n/g,"<br />\n")}function h(a){var b=new Date(Number(a)),c=b.getUTCFullYear();if(c<1e3){c+=1900}return b.getUTCDate()+"-"+(b.getUTCMonth()+1)+"-"+c}function g(){if(e.username===""){alert("Make sure you specify at least your username."+"\n"+"See http://pwi.googlecode.com for more info");return}if(e.useQueryParameters){var a=document.URL.split("?",2);if(a.length==2){var b=a[1].split("&");var c=false;var d=1;for($queryParam in b){var f=b[$queryParam].split("=",2);if(f.length==2){if(f[0]=="pwi_album_selected"){e.mode="album";e.album=f[1];c=true}if(f[0]=="pwi_albumpage"){d=f[1]}if(f[0]=="pwi_showpermalink"){e.showPermaLink=true}}}if(c){e.page=d;e.showPermaLink=false}}}switch(e.mode){case"latest":t();break;case"album":s();break;case"keyword":s();break;default:r();break}}function f(){e=c;ts=(new Date).getTime();e.id=ts;d=a("<div id='pwi_"+ts+"'/>").appendTo(b);d.addClass("pwi_container");g();return false}var d,e={};c=a.extend(true,{},a.fn.pwi.defaults,c);if(c.popupPlugin==""){if(a.fn.fancybox){c.popupPlugin="fancybox";c.popupExt=function(a,b){if(a==="lb"){b.fancybox(c.fancybox_config.config_photos)}else if(a==="yt"){b.fancybox(c.fancybox_config.config_youtube)}else if(a==="sl"){b.fancybox(c.fancybox_config.config_slideshow)}else if(a==="map"){b.fancybox(c.fancybox_config.config_maps)}}}else if(a.fn.slimbox){c.popupPlugin="slimbox"}}b=this;f()};a.fn.pwi.defaults={mode:"albums",username:"",album:"",authKey:"",albums:[],keyword:"",albumKeywords:[],albumStartDateTime:"",albumEndDateTime:"",albumCrop:1,albumTitle:"",albumThumbSize:160,albumThumbAlign:1,albumMaxResults:999,albumsPerPage:999,albumPage:1,albumTypes:"public",page:1,photoSize:800,maxResults:50,showPager:"bottom",thumbSize:72,thumbCrop:0,thumbAlign:0,thumbCss:{margin:"5px"},onclickThumb:"",onclickAlbumThumb:"",sortAlbums:"none",sortPhotos:"none",removeAlbums:[],removeAlbumTypes:[],showAlbumTitles:true,showAlbumTitlesLength:9999,showAlbumThumbs:true,showAlbumdate:true,showAlbumPhotoCount:true,showAlbumDescription:true,showAlbumLocation:true,showSlideshow:true,showSlideshowLink:false,showPhotoCaption:false,showPhotoCaptionDate:false,showCaptionLength:9999,showPhotoDownload:false,showPhotoDownloadPopup:false,showPhotoDate:true,showPermaLink:false,showPhotoLocation:false,mapIconLocation:"",useQueryParameters:true,loadingImage:"",videoBorder:"images/video.jpg",labels:{photo:"photo",photos:"photos",downloadphotos:"Download photos",albums:"Back to albums",slideshow:"Display slideshow",noalbums:"No albums available",loading:"PWI fetching data...",page:"Page",prev:"Previous",next:"Next",showPermaLink:"Show PermaLink",devider:"|"},months:["January","February","March","April","May","June","July","August","September","October","November","December"],fancybox_config:{config_photos:{titleFormat:formatTitle,hideOnContentClick:false},config_youtube:{showNavArrows:false,hideOnContentClick:false,width:"90%",height:"90%"},config_slideshow:{showNavArrows:false,titleShow:false,hideOnContentClick:false},config_maps:{showNavArrows:false,titleShow:false,hideOnContentClick:false}},slimbox_config:{loop:false,overlayOpacity:.6,overlayFadeDuration:400,resizeDuration:400,resizeEasing:"swing",initialWidth:250,initlaHeight:250,imageFadeDuration:400,captionAnimationDuration:400,counterText:"{x}/{y}",closeKeys:[27,88,67,70],prevKeys:[37,80],nextKeys:[39,83]},blockUIConfig:{message:"<div class='lbLoading pwi_loader'>loading...</div>",css:"pwi_loader"},albumstore:{},photostore:{},popupPlugin:"",popupExt:"",token:""}})(jQuery)

