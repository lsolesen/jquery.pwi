/**
 * Picasa Webalbum Integration jQuery plugin
 * This library was inspired aon pwa by Dieter Raber
 * @name jquery.pwi.js
 * @author Jeroen Diderik - http://www.multiprof.nl/
 * @revision 1.0.47
 * @date September 08, 2009
 * @copyright (c) 2009 Jeroen Diderik(www.multiprof.nl)
 * @license Creative Commons Attribution-Share Alike 3.0 Netherlands License - http://creativecommons.org/licenses/by-sa/3.0/nl/
 * @Visit http://pwi.googlecode.com/ for more informations, duscussions etc about this library
 */
(function(a){a.fn.pwi=function(c){var d;this.each(function(){d=a.data(this,"pwi");if(d){return false}new a.pwiGallery(this,c)});return d||this};a.pwi={version:"1.0.31",setDefaults:function(c){a.extend(b,c)}};var b={mode:"albums",username:"",album:"",authKey:"",albums:[],albumCrop:1,albumTitle:"",albumThumbSize:160,albumMaxResults:999,albumStartIndex:1,albumTypes:"public",page:1,photoSize:800,maxResults:50,thumbSize:72,thumbCrop:0,thumbCss:{margin:"5px"},onclickThumb:"",showAlbumTitles:true,showAlbumdate:true,showAlbumPhotoCount:true,showAlbumDescription:true,showAlbumLocation:true,showSlideshowLink:true,showPhotoCaption:false,showPhotoDate:true,labels:{photo:"photo",photos:"photos",albums:"Back to albums",slideshow:"Display slideshow",loading:"PWI fetching data...",page:"Page",prev:"Previous",next:"Next",devider:"|"},months:["January","February","March","April","May","June","July","August","September","October","November","December"],slimbox_config:{loop:false,overlayOpacity:0.6,overlayFadeDuration:400,resizeDuration:400,resizeEasing:"swing",initialWidth:250,initlaHeight:250,imageFadeDuration:400,captionAnimationDuration:400,counterText:"{x}/{y}",closeKeys:[27,88,67,70],prevKeys:[37,80],nextKeys:[39,83]},blockUIConfig:{message:"<div class='lbLoading pwi_loader'>loading...</div>",css:"pwi_loader"},albumstore:"",photostore:"",token:""};a.pwiGallery=function(c,s){var m,e=this,f;f=a.extend({},b,s);m=a(c);m.addClass("pwi_container");if(f.username==""){alert("Make sure you specify at least your username.\nSee http://pwi.googlecode.com for more info");return}switch(f.mode){case"latest":p();break;default:a.historyInit(k);break}function i(){var v,u,t=0;this.push=function(x){if(typeof(v)=="undefined"){u=new Array();v=u}else{var w=u;u=new Array();w[1]=u}u[0]=x;++t};this.toString=function(){if(t==0){return}while(t>1){var z=v,y=new Array(),x=y,w=0;while(typeof(z)!="undefined"){if(typeof(x[0])=="undefined"){x[0]=z[0];++w}else{if(typeof(z[0])!="undefined"){x[0]+=z[0]}x[1]=new Array();x=x[1]}z=z[1]}v=y;u=x;t=w}return v[0]}}function r(u){var v=new Date(Number(u)),t=v.getYear();if(t<1000){t+=1900}return(f.months[(v.getMonth())]+" "+v.getDate()+", "+t)}function o(u){var v=new Date(Number(u)),t=v.getYear();if(t<1000){t+=1900}return(v.getDate()+"-"+(v.getMonth()+1)+"-"+t+" "+v.getHours()+":"+(v.getMinutes()<10?"0"+v.getMinutes():v.getMinutes()))}function h(v){var u=new i();for(var w=0;w<v.feed.entry.length;w++){var t=v.feed.entry[w].gphoto$name.$t,x=r(v.feed.entry[w].gphoto$timestamp.$t),y=v.feed.entry[w].media$group.media$thumbnail[0].url.replace(new RegExp("/s160-c/","g"),"/");if(a.inArray(t,f.albums)>-1||f.albums.length==0){u.push("<div class='pwi_album'><a class='standard' href='#' onclick='javascript:$.historyLoad(\""+f.username+"/"+t+"/1\");return false;' title='"+v.feed.entry[w].title.$t+"'>");u.push("<img src='"+y+"?imgmax="+f.albumThumbSize+"&crop="+f.albumCrop+"'/><br>");f.showAlbumTitles?u.push("<a href='#' onclick='javascript:$.historyLoad(\""+f.username+"/"+t+"/1\");return false;'>"+v.feed.entry[w].title.$t+"</a><br/>"+(f.showAlbumdate?x:"")+(f.showAlbumPhotoCount?"&nbsp;&nbsp;&nbsp;&nbsp;"+v.feed.entry[w].gphoto$numphotos.$t+" "+f.labels.photos:"")):false;u.push("</div>")}}u.push("<div style='clear: both;height:0px;'> </div>");f.albumstore=u.toString();j(false,f.albumstore)}function d(E){var C=new i(),K=E.feed.openSearch$totalResults.$t,G=E.feed.gphoto$location.$t=="undefined"?"":E.feed.gphoto$location.$t,I=E.feed.subtitle.$t=="undefined"?"":E.feed.subtitle.$t,x=r(E.feed.gphoto$timestamp.$t),z=(K=="1")?false:true,u=E.feed.entry.length;f.albumTitle=E.feed.title.$t=="undefined"?f.albumTitle:E.feed.title.$t;C.push("<div class='pwi_album_description'>");if(f.mode!="album"){C.push("<a href='#' onclick='$.historyLoad(\"\");return false;'>"+f.labels.albums+"</a> &gt; "+f.albumTitle+"<br/>")}if(f.showAlbumDescription){C.push("<div class='title'>"+f.albumTitle+"</div>");C.push("<div class='details'>"+K+" "+(z?f.labels.photos:f.labels.photo)+(f.showAlbumdate?", "+x:"")+(f.showAlbumLocation&&G?", "+G:"")+"</div>");C.push("<div class='description'>"+I+"</div>");if(f.showSlideshowLink){C.push("<a href='http://picasaweb.google.com/"+f.username+"/"+E.feed.gphoto$name.$t+""+((f.authKey!="")?"?authkey="+f.authKey:"")+"#slideshow/"+E.feed.entry[0].gphoto$id.$t+"' rel='gb_page_fs[]' target='_new' class='sslink'>"+f.labels.slideshow+"</a>")}}C.push("</div>");if(K>f.maxResults){$pageCount=(K/f.maxResults);var J=f.labels.prev+" "+f.labels.devider+" ",D=f.labels.devider+" "+f.labels.next,B=new i();if(f.page>1){J="<a href='#' onclick='$.historyLoad(\""+f.username+"/"+f.album+"/"+(parseInt(f.page)-1)+"\");return false;' id='pwiPrevPage'>"+f.labels.prev+"</a> | "}if(f.page<$pageCount){D="| <a href='#' onclick='$.historyLoad(\""+f.username+"/"+f.album+"/"+(parseInt(f.page)+1)+"\");return false;' id='pwiNextPage'>"+f.labels.next+"</a>"}B.push("<div class='pwi_pager'>"+J+f.labels.page+" ");for(var F=1;F<$pageCount+1;F++){if(F==f.page){B.push("<span class='pwi_pager_current'>"+F+"</span> ")}else{B.push("<a href='#' onclick='$.historyLoad(\""+f.username+"/"+f.album+"/"+F+"\");return false;'>"+F+"</a> ")}}B.push(D+"</div>");C.push(B.toString())}for(var F=0;F<u;F++){var A=E.feed.entry[F].content.src,w=E.feed.entry[F].gphoto$id.$t,v=(E.feed.entry[F].summary.$t?E.feed.entry[F].summary.$t:""),y=f.showPhotoDate?(E.feed.entry[F].exif$tags.exif$time?o(E.feed.entry[F].exif$tags.exif$time.$t):E.feed.entry[F].published.$t):"",t=y+" "+v.replace(new RegExp("'","g"),"&#39;");C.push("<div class='pwi_photo' style='height:"+(f.thumbSize+1)+"px;'>");C.push("<a href='"+A+"?imgmax="+f.photoSize+"' rel='lb-"+f.username+"' title='"+t+"'>");C.push("<img src='"+A+"?imgmax="+f.thumbSize+"&crop="+f.thumbCrop+"'/></a>");if(f.showPhotoCaption){C.push("<br/>"+v)}C.push("</div>")}C.push(B);C.push("<div style='clear: both;height:0px;'> </div>");f.photostore=C.toString();j(false,f.photostore);var H=a(".pwi_photo");H.css(f.thumbCss);if(typeof(f.onclickThumb)!="function"&&a.slimbox){H.find("a[rel='lb-"+f.username+"']").slimbox(f.slimbox_config)}else{if(typeof(f.onclickThumb)=="function"){H.find("a[rel='lb-"+f.username+"']").bind("click",n)}}}function g(x){var A=new i(),v=x.feed.entry.length?x.feed.entry.length:0;for(var y=0;y<v;y++){var w=x.feed.entry[y].content.src,B=x.feed.entry[y].gphoto$id.$t,u=f.showPhotoCaption?(x.feed.entry[y].summary.$t?x.feed.entry[y].summary.$t:""):"",C=f.showPhotoDate?(x.feed.entry[y].exif$tags.exif$time?o(x.feed.entry[y].exif$tags.exif$time.$t):x.feed.entry[y].published.$t):"",t=C+" "+u.replace(new RegExp("'","g"),"&#39;");A.push("<div class='pwi_photo' >");A.push("<a href='"+w+"?imgmax="+f.photoSize+"' rel='lb-"+f.username+"' title='"+t+"'>");A.push("<img src='"+w+"?imgmax="+f.thumbSize+"&crop="+f.thumbCrop+"'/></a>");A.push("<br/>"+u);A.push("</div>")}A.push("<div style='clear: both;height:0px;'> </div>");j(false,A.toString());var z=a("div.pwi_photo").css(f.thumbCss);if(typeof(f.onclickThumb)!="function"&&a.slimbox){z.find("a[rel='lb-"+f.username+"']").slimbox(f.slimbox_config)}else{if(typeof(f.onclickThumb)=="function"){z.find("a[rel='lb-"+f.username+"']").bind("click",n)}}}function n(){f.onclickThumb.call(this);return false}function q(){if(f.albumstore!=""){j(false,f.albumstore)}else{j(true,"");var t="http://picasaweb.google.com/data/feed/api/user/"+f.username+"?kind=album&max-results="+f.albumMaxResults+"&access="+f.albumTypes+"&alt=json";a.getJSON(t,"callback=?",h)}return m}function l(){var t=((f.page-1)*f.maxResults)+1,u="http://picasaweb.google.com/data/feed/api/user/"+f.username+"/album/"+f.album+"?kind=photo&max-results="+f.maxResults+"&start-index="+t+"&alt=json"+((f.authKey!="")?"&authkey="+f.authKey:"");j(true,"");a.getJSON(u,"callback=?",d);return m}function p(){j(true,"");var t="http://picasaweb.google.com/data/feed/api/user/"+f.username+(f.album!=""?"/album/"+f.album:"")+"?kind=photo&max-results="+f.maxResults+"&alt=json&q="+((f.authKey!="")?"&authkey="+f.authKey:"");a.getJSON(t,"callback=?",g);return m}function k(t){if(t){if(t.split("/").length>2){f.username=t.split("/")[0];f.album=t.split("/")[1];f.page=t.split("/")[2];l()}else{if(t.split("/").length>1){f.album=t.split("/")[0];f.page=t.split("/")[1];l()}}}else{if(f.album!=""&&f.mode=="album"){l()}else{q()}}}function j(u,t){if(u){if(a.blockUI){m.block(f.blockUIConfig)}}else{if(a.blockUI){m.unblock()}m.html(t)}}}})(jQuery);