// jquery.pwi.js BETA RELEASE... FOR TESTING ONLY
(function(a){a.fn.pwi=function(b){var c=a.extend(true,{},{mode:"albums",username:"",album:"",albums:[],albumCrop:1,albumTitle:"",albumThumbSize:160,albumMaxResults:999,page:1,photoSize:800,maxResults:50,thumbSize:72,thumbCrop:0,thumbCss:{padding:"3px"},thumbClick:"",showAlbumTitles:true,showAlbumdate:true,showAlbumPhotoCount:true,showAlbumDescription:true,showAlbumLocation:true,showSlideshowLink:true,showPhotoCaption:true,showPhotoDate:true,labels:{photo:"photo",photos:"photos",albums:"Back to albums",slideshow:"Display slideshow",loading:"PWI fetching data...",page:"Page",prev:"Previous",next:"Next",devider:"|"},slimbox_config:{loop:false,overlayOpacity:0.6,overlayFadeDuration:400,resizeDuration:400,resizeEasing:"swing",initialWidth:250,initlaHeight:250,imageFadeDuration:400,captionAnimationDuration:400,counterText:"{x}/{y}",closeKeys:[27,88,67,70],nextKeys:[37,80],nextKeys:[39,83]},albumstore:"",photostore:""},b);return this.each(function(){var h=a(this);if(c.username==""){alert("Make sure you specify at least your username.\nSee http://pwi.googlecode.com for more info");return}switch(c.mode){case"latest":n();break;default:a.historyInit(j);break}function g(){var s,r,q=0;this.push=function(u){if(typeof(s)=="undefined"){r=new Array();s=r}else{var t=r;r=new Array();t[1]=r}r[0]=u;++q};this.toString=function(){if(q==0){return}while(q>1){var w=s,v=new Array(),u=v,t=0;while(typeof(w)!="undefined"){if(typeof(u[0])=="undefined"){u[0]=w[0];++t}else{if(typeof(w[0])!="undefined"){u[0]+=w[0]}u[1]=new Array();u=u[1]}w=w[1]}s=v;r=u;q=t}return s[0]}}function p(t){var q=new Array(12),r=new Date(Number(t)),s=r.getYear();q[0]="January";q[1]="February";q[2]="March";q[3]="April";q[4]="May";q[5]="June";q[6]="July";q[7]="August";q[8]="September";q[9]="October";q[10]="November";q[11]="December";if(s<1000){s+=1900}return(q[(r.getMonth())]+" "+r.getDate()+", "+s)}function l(s){var q=new Date(Number(s)),r=q.getYear();if(r<1000){r+=1900}return(q.getDate()+"-"+(q.getMonth()+1)+"-"+r+" "+q.getHours()+":"+(q.getMinutes()<10?"0"+q.getMinutes():q.getMinutes()))}function e(r){var v=new g();for(var s=0;s<r.feed.entry.length;s++){var t=r.feed.entry[s].gphoto$name.$t,u=p(r.feed.entry[s].gphoto$timestamp.$t),q=r.feed.entry[s].media$group.media$thumbnail[0].url.replace(new RegExp("/s160-c/","g"),"/");v.push("<div class='pwi_album'><a class='standard' href='#' onclick='javascript:$.historyLoad(\""+t+"/1\");return false;' title='"+r.feed.entry[s].title.$t+"'>");v.push("<img src='"+q+"?imgmax="+c.albumThumbSize+"&crop="+c.albumCrop+"'/><br>");c.showAlbumTitles?v.push("<a href='#' onclick='javascript:$.historyLoad(\""+t+"/1\");return false;'>"+r.feed.entry[s].title.$t+"</a><br/>"+(c.showAlbumdate?u:"")+(c.showAlbumPhotoCount?"&nbsp;&nbsp;&nbsp;&nbsp;"+r.feed.entry[s].gphoto$numphotos.$t+" "+c.labels.photos:"")):false;v.push("</div>");c.albums[s]=t}v.push("<div style='clear: both;height:0px;'> </div>");c.albumstore=v.toString();i(false,c.albumstore)}function d(B){var w=new g(),q=B.feed.openSearch$totalResults.$t,v=B.feed.gphoto$location.$t=="undefined"?"":B.feed.gphoto$location.$t,G=B.feed.subtitle.$t=="undefined"?"":B.feed.subtitle.$t,H=p(B.feed.gphoto$timestamp.$t),A=(q=="1")?false:true,D=B.feed.entry.length;c.albumTitle=B.feed.title.$t=="undefined"?c.albumTitle:B.feed.title.$t;w.push("<div class='pwi_album_description'>");if(c.mode!="album"){w.push("<a href='#' onclick='$.historyLoad(\"\");return false;'>"+c.labels.albums+"</a> &gt; "+c.albumTitle+"<br/>")}if(c.showAlbumDescription){w.push("<div class='title'>"+c.albumTitle+"</div>");w.push("<div class='details'>"+q+" "+(A?c.labels.photos:c.labels.photo)+(c.showAlbumdate?", "+H:"")+(c.showAlbumLocation&&v?", "+v:"")+"</div>");w.push("<div class='description'>"+G+"</div>");if(c.showSlideshowLink){w.push("<a href='http://picasaweb.google.com/"+c.username+"/"+B.feed.gphoto$name.$t+"/photo#s"+B.feed.entry[0].gphoto$id.$t+"' rel='gb_page_fs[]' target='_new' class='sslink'>"+c.labels.slideshow+"</a>")}}w.push("</div>");if(q>c.maxResults){pageCount=(q/c.maxResults);var t=c.labels.prev+" "+c.labels.devider+" ",r=c.labels.devider+" "+c.labels.next,x=new g();if(c.page>1){t="<a href='#' onclick='$.historyLoad(\""+c.album+"/"+(parseInt(c.page)-1)+"\");return false;'>"+c.labels.prev+"</a> | "}if(c.page<pageCount){r="| <a href='#' onclick='$.historyLoad(\""+c.album+"/"+(parseInt(c.page)+1)+"\");return false;'>"+c.labels.next+"</a>"}x.push("<div class='pwi_pager'>"+t+c.labels.page+" ");for(var C=1;C<pageCount+1;C++){if(C==c.page){x.push("<span class='pwi_pager_current'>"+C+"</span> ")}else{x.push("<a href='#' onclick='$.historyLoad(\""+c.album+"/"+C+"\");return false;'>"+C+"</a> ")}}x.push(r+"</div>");w.push(x.toString())}for(var C=0;C<D;C++){var u=B.feed.entry[C].content.src,E=B.feed.entry[C].gphoto$id.$t,I=c.showPhotoCaption?(B.feed.entry[C].summary.$t?B.feed.entry[C].summary.$t:""):"",z=c.showPhotoDate?(B.feed.entry[C].exif$tags.exif$time?l(B.feed.entry[C].exif$tags.exif$time.$t):B.feed.entry[C].published.$t):"",F=z+" "+I.replace(new RegExp("'","g"),"&#39;");w.push("<div class='pwi_photo' style='height:"+c.thumbSize+"px;'>");w.push("<a href='"+u+"?imgmax="+c.photoSize+"' rel='lightbox-photo' title='"+F+"'>");w.push("<img src='"+u+"?imgmax="+c.thumbSize+"&crop="+c.thumbCrop+"'/></a>");w.push("</div>")}w.push(x);w.push("<div style='clear: both;height:0px;'> </div>");c.photostore=w.toString();i(false,c.photostore);var y=a("div.pwi_photo").css(c.thumbCss);if(typeof(c.onclickThumb)!="function"&&a.slimbox){y.find("a").slimbox(c.slimbox_config)}else{y.find("a").bind("click",m)}}function f(t){var r=new g();var w=t.feed.entry.length?t.feed.entry.length:0;for(var v=0;v<w;v++){var z=t.feed.entry[v].content.src,u=t.feed.entry[v].gphoto$id.$t,y=c.showPhotoCaption?(t.feed.entry[v].summary.$t?t.feed.entry[v].summary.$t:""):"",q=c.showPhotoDate?(t.feed.entry[v].exif$tags.exif$time?l(t.feed.entry[v].exif$tags.exif$time.$t):t.feed.entry[v].published.$t):"",x=q+" "+y.replace(new RegExp("'","g"),"&#39;");r.push("<div class='pwi_photo' style='height:"+c.latest_thumbSize+"px;'>");r.push("<a href='"+z+"?imgmax="+c.photoSize+"' rel='lightbox-photo' title='"+x+"'>");r.push("<img src='"+z+"?imgmax="+c.thumbSize+"&crop="+c.thumbCrop+"'/></a>");r.push("</div>")}i(false,r.toString());var A=a("div.pwi_photo").css(c.thumbCss);if(typeof(c.onclickThumb)!="function"&&a.slimbox){A.find("a").slimbox(c.slimbox_config)}else{A.find("a").bind("click",m)}}function m(){c.onclickThumb.call(this);return false}function o(){if(c.albumstore!=""){i(false,c.albumstore)}else{i(true,"");var q="http://picasaweb.google.com/data/feed/api/user/"+c.username+"?category=album&max-results="+c.albumMaxResults+"&access=public&alt=json";a.getJSON(q,"callback=?",e)}}function k(){var r=((c.page-1)*c.maxResults)+1,q="http://picasaweb.google.com/data/feed/api/user/"+c.username+"/album/"+c.album+"?category=photo&max-results="+c.maxResults+"&start-index="+r+"&alt=json";i(true,"");a.getJSON(q,"callback=?",d)}function n(){i(true,"");var q="http://picasaweb.google.com/data/feed/api/user/"+c.username+(c.album!=""?"/album/"+c.album:"")+"?kind=photo&max-results="+c.maxResults+"&alt=json&q=";a.getJSON(q,"callback=?",f)}function j(q){if(q){if(q.indexOf("/")>0){c.album=q.split("/")[0];c.page=q.split("/")[1];k()}}else{if(c.album!=""&&c.mode=="album"){k()}else{o()}}}function i(r,q){if(r){h.block({message:"<div class='lbLoading pwi_loader'>"+c.labels.loading+"</div>",css:"pwi_loader"})}else{h.unblock().html(q)}}})}})(jQuery);